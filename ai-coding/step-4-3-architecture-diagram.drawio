<mxfile host="app.diagrams.net" modified="2026-01-02T00:00:00.000Z" agent="draw.io" version="22.0.0">
  <diagram name="价格体系Bug修复架构图" id="architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- 标题 -->
        <mxCell id="title" value="mall电商系统 - 价格体系Bug修复架构图" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        
        <!-- 客户端层 -->
        <mxCell id="client-layer" value="客户端层" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="web-client" value="Web前端" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#e1f5fe;strokeColor=#01579b;" vertex="1" parent="1">
          <mxGeometry x="100" y="140" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="app-client" value="移动端APP" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#e1f5fe;strokeColor=#01579b;" vertex="1" parent="1">
          <mxGeometry x="100" y="180" width="120" height="30" as="geometry" />
        </mxCell>
        
        <!-- Controller层 -->
        <mxCell id="controller-layer" value="Controller层 (修复1个文件)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#fff4e6;strokeColor=#e67700;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="320" y="100" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="cart-controller" value="OmsCartItemController&#xa;购物车接口 (112行)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff9c4;strokeColor=#f57f17;" vertex="1" parent="1">
          <mxGeometry x="335" y="145" width="170" height="60" as="geometry" />
        </mxCell>
        
        <!-- Service层 -->
        <mxCell id="service-layer" value="Service层 (修复2个文件)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#f3e5f5;strokeColor=#8e24aa;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="600" y="100" width="480" height="340" as="geometry" />
        </mxCell>
        
        <!-- 购物车服务 -->
        <mxCell id="cart-service" value="OmsCartItemServiceImpl&#xa;购物车业务逻辑 (140行)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#e1bee7;strokeColor=#7b1fa2;align=center;" vertex="1" parent="1">
          <mxGeometry x="620" y="145" width="200" height="60" as="geometry" />
        </mxCell>
        
        <!-- 促销服务 -->
        <mxCell id="promotion-service" value="OmsPromotionServiceImpl&#xa;促销计算核心 (274行)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#e1bee7;strokeColor=#7b1fa2;align=center;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="850" y="145" width="210" height="60" as="geometry" />
        </mxCell>
        
        <!-- Bug修复区域 -->
        <mxCell id="bug-fixes" value="Bug修复点 (15个)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fontStyle=1;fillColor=#ffebee;strokeColor=#c62828;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="620" y="230" width="440" height="190" as="geometry" />
        </mxCell>
        
        <mxCell id="p0-bugs" value="P0级 (4个)&#xa;• 空指针异常修复&#xa;• 满减除零异常&#xa;• 优惠金额分摊精度&#xa;• realStock默认值" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffcdd2;strokeColor=#b71c1c;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="635" y="260" width="130" height="145" as="geometry" />
        </mxCell>
        
        <mxCell id="p1-bugs" value="P1级 (6个)&#xa;• 满减规则精度&#xa;• 阶梯排序溢出&#xa;• 购物车价格验证&#xa;• 促销查找优化&#xa;• 数据库索引优化&#xa;• 库存计算负数" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffccbc;strokeColor=#d84315;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="780" y="260" width="130" height="145" as="geometry" />
        </mxCell>
        
        <mxCell id="p2-bugs" value="P2级 (5个)&#xa;• IN查询限制&#xa;• 重复排序优化&#xa;• 对象创建优化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe0b2;strokeColor=#e65100;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="925" y="260" width="120" height="145" as="geometry" />
        </mxCell>
        
        <!-- DAO层 -->
        <mxCell id="dao-layer" value="DAO层 (修复1个文件)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#e8f5e9;strokeColor=#2e7d32;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="320" y="480" width="760" height="120" as="geometry" />
        </mxCell>
        <mxCell id="product-dao" value="PortalProductDao.xml&#xa;商品查询SQL (102行)&#xa;• 添加数据库索引&#xa;• SQL排序优化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#c8e6c9;strokeColor=#1b5e20;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="340" y="520" width="720" height="60" as="geometry" />
        </mxCell>
        
        <!-- 数据库层 -->
        <mxCell id="database-layer" value="数据库层 (MySQL 5.7)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#fce4ec;strokeColor=#c2185b;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="320" y="640" width="760" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="db-tables" value="核心表" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#f8bbd0;strokeColor=#880e4f;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="340" y="680" width="340" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="table-list" value="• oms_cart_item (购物车)&#xa;• pms_product (商品)&#xa;• pms_sku_stock (SKU库存) ← 添加索引&#xa;• pms_product_ladder (阶梯价格) ← 添加索引&#xa;• pms_product_full_reduction (满减) ← 添加索引" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="345" y="700" width="330" height="55" as="geometry" />
        </mxCell>
        
        <!-- 缓存层 -->
        <mxCell id="cache-layer" value="缓存层 (Redis 7.0)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#f8bbd0;strokeColor=#880e4f;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="710" y="680" width="350" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="redis-usage" value="• 商品信息缓存 (5分钟)&#xa;• 促销规则缓存&#xa;• 分布式锁 (并发控制)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="720" y="705" width="330" height="50" as="geometry" />
        </mxCell>
        
        <!-- 连接线 -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="client-layer" target="controller-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-label" value="HTTP请求" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow1">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="cart-controller" target="service-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-label" value="调用Service" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow2">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="cart-service" target="dao-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="promotion-service" target="dao-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow4-label" value="查询促销数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow4">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint x="-10" y="-5" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="dao-layer" target="database-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow5-label" value="SQL查询" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow5">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;dashed=1;strokeColor=#f57c00;" edge="1" parent="1" source="cart-service" target="promotion-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow6-label" value="调用促销计算" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow6">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- 监控告警 -->
        <mxCell id="monitoring" value="监控告警系统" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#fffde7;strokeColor=#f9a825;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="270" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="monitor-items" value="• 异常监控 (0告警)&#xa;• 性能监控 (&lt;500ms)&#xa;• QPS监控 (&gt;1000)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;spacingLeft=5;" vertex="1" parent="1">
          <mxGeometry x="85" y="285" width="150" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1;dashed=1;strokeColor=#f57c00;" edge="1" parent="1" source="monitoring" target="service-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow7-label" value="监控指标" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;" vertex="1" connectable="0" parent="arrow7">
          <mxGeometry x="-0.1" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- 安全层 -->
        <mxCell id="security" value="安全防护" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fillColor=#fce4ec;strokeColor=#c2185b;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="370" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="security-items" value="• 价格验证 (防篡改)&#xa;• SQL注入防护&#xa;• 参数数量限制" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;spacingLeft=5;" vertex="1" parent="1">
          <mxGeometry x="85" y="385" width="150" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;strokeWidth=1;dashed=1;strokeColor=#c2185b;" edge="1" parent="1" source="security" target="service-layer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 图例 -->
        <mxCell id="legend" value="图例" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fontStyle=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="80" y="480" width="160" height="300" as="geometry" />
        </mxCell>
        
        <mxCell id="legend1" value="修复文件" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff9c4;strokeColor=#f57f17;" vertex="1" parent="1">
          <mxGeometry x="95" y="510" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend2" value="P0级严重Bug" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffcdd2;strokeColor=#b71c1c;" vertex="1" parent="1">
          <mxGeometry x="95" y="545" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend3" value="P1级高危问题" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffccbc;strokeColor=#d84315;" vertex="1" parent="1">
          <mxGeometry x="95" y="580" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend4" value="P2级中危优化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe0b2;strokeColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="95" y="615" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend5" value="数据库优化" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#c8e6c9;strokeColor=#1b5e20;" vertex="1" parent="1">
          <mxGeometry x="95" y="650" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend6" value="缓存层" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#f8bbd0;strokeColor=#880e4f;" vertex="1" parent="1">
          <mxGeometry x="95" y="685" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend7" value="监控告警" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fffde7;strokeColor=#f9a825;" vertex="1" parent="1">
          <mxGeometry x="95" y="720" width="130" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend8" value="安全防护" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fce4ec;strokeColor=#c2185b;" vertex="1" parent="1">
          <mxGeometry x="95" y="755" width="130" height="25" as="geometry" />
        </mxCell>
        
        <!-- 统计信息 -->
        <mxCell id="stats" value="修复统计&#xa;━━━━━━━━━&#xa;涉及文件: 4个&#xa;修复问题: 15个&#xa;工期预估: 25天&#xa;团队人数: 7人" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=1;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="1140" y="100" width="140" height="120" as="geometry" />
        </mxCell>
        
        <!-- 版本信息 -->
        <mxCell id="version" value="文档版本: v2.0&#xa;创建日期: 2026-01-02&#xa;状态: 待评审" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1140" y="750" width="140" height="50" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
